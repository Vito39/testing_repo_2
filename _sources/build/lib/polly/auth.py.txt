from polly.session import PollySession

link_doc = "https://docs.elucidata.io/OmixAtlas/Polly%20Python.html"


class UnauthorizedException(Exception):
    def __str__(self):
        return f"Authorization failed as credentials not found. Please use Polly.auth(token) as shown here  ---- {link_doc}"


class Polly:
    """
    This is a class for authorization for polly.
    There are function classmethods
    
    #. auth(token,env)
    #. get_session(token,env)
    """
    default_session = None

    @classmethod
    def auth(cls, token, env="polly"):
        """
        function for auth to connect on polly

        ``Args:``
            |  ``token (str):`` token copy from polly.
            |  ``env (str):`` polly or testpolly or devpolly.

        To use auth function import class Polly
        

        .. code::


                from polly.auth import Polly
                obj = Polly.auth(token,'env')
        
        ``Returns:``
            |  if token is not satisfied it will throw a error.
            |  else it will auth you  

        """
        cls.default_session = PollySession(token, env=env)

    @classmethod
    def get_session(cls, token=None, env="polly"):
        """
        function to get session for polly

        ``Args:``
            |  ``token (str):`` token copy from polly.
            |  ``env (str):`` polly or testpolly or devpolly.

        To use auth function import class Polly


        .. code::


                from polly.auth import Polly
                polly.get_session(token,'env')

        ``Returns:``        
            |  if token is not satisfied it will throw UnauthorizedException.
            |  else it will return a polly.session object   
        """
        if not token:
            if not cls.default_session:
                raise UnauthorizedException
            else:
                return cls.default_session
        else:
            return PollySession(token, env=env)
