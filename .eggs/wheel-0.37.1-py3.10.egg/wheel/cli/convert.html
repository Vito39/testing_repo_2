<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Polly_Documentation 1 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> Polly_Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../Polly.html">About Polly Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../download.html">Downloading any dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../polly.html">polly package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../query.html">Querying metadata</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Polly_Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/.eggs/wheel-0.37.1-py3.10.egg/wheel/cli/convert.py.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>import os.path
import re
import shutil
import sys
import tempfile
import zipfile
from distutils import dist
from glob import iglob</p>
<p>from ..bdist_wheel import bdist_wheel
from ..wheelfile import WheelFile
from . import WheelError, require_pkgresources</p>
<dl>
<dt>egg_info_re = re.compile(r’’’</dt><dd><p>(?P&lt;name&gt;.+?)-(?P&lt;ver&gt;.+?)
(-(?P&lt;pyver&gt;pyd.d+)</p>
<blockquote>
<div><p>(-(?P&lt;arch&gt;.+?))?</p>
</div></blockquote>
<p>)?.egg$’’’, re.VERBOSE)</p>
</dd>
<dt>class _bdist_wheel_tag(bdist_wheel):</dt><dd><p># allow the client to override the default generated wheel tag
# The default bdist_wheel implementation uses python and abi tags
# of the running python process. This is not suitable for
# generating/repackaging prebuild binaries.</p>
<p>full_tag_supplied = False
full_tag = None  # None or a (pytag, soabitag, plattag) triple</p>
<dl class="simple">
<dt>def get_tag(self):</dt><dd><dl class="simple">
<dt>if self.full_tag_supplied and self.full_tag is not None:</dt><dd><p>return self.full_tag</p>
</dd>
<dt>else:</dt><dd><p>return bdist_wheel.get_tag(self)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>def egg2wheel(egg_path, dest_dir):</dt><dd><p>filename = os.path.basename(egg_path)
match = egg_info_re.match(filename)
if not match:</p>
<blockquote>
<div><p>raise WheelError(‘Invalid egg file name: {}’.format(filename))</p>
</div></blockquote>
<p>egg_info = match.groupdict()
dir = tempfile.mkdtemp(suffix=”_e2w”)
if os.path.isfile(egg_path):</p>
<blockquote>
<div><p># assume we have a bdist_egg otherwise
with zipfile.ZipFile(egg_path) as egg:</p>
<blockquote>
<div><p>egg.extractall(dir)</p>
</div></blockquote>
</div></blockquote>
<dl>
<dt>else:</dt><dd><p># support buildout-style installed eggs directories
for pth in os.listdir(egg_path):</p>
<blockquote>
<div><p>src = os.path.join(egg_path, pth)
if os.path.isfile(src):</p>
<blockquote>
<div><p>shutil.copy2(src, dir)</p>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p>shutil.copytree(src, os.path.join(dir, pth))</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<p>pyver = egg_info[‘pyver’]
if pyver:</p>
<blockquote>
<div><p>pyver = egg_info[‘pyver’] = pyver.replace(‘.’, ‘’)</p>
</div></blockquote>
<p>arch = (egg_info[‘arch’] or ‘any’).replace(‘.’, ‘_’).replace(‘-’, ‘_’)</p>
<p># assume all binary eggs are for CPython
abi = ‘cp’ + pyver[2:] if arch != ‘any’ else ‘none’</p>
<p>root_is_purelib = egg_info[‘arch’] is None
if root_is_purelib:</p>
<blockquote>
<div><p>bw = bdist_wheel(dist.Distribution())</p>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p>bw = _bdist_wheel_tag(dist.Distribution())</p>
</dd>
</dl>
<p>bw.root_is_pure = root_is_purelib
bw.python_tag = pyver
bw.plat_name_supplied = True
bw.plat_name = egg_info[‘arch’] or ‘any’
if not root_is_purelib:</p>
<blockquote>
<div><p>bw.full_tag_supplied = True
bw.full_tag = (pyver, abi, arch)</p>
</div></blockquote>
<p>dist_info_dir = os.path.join(dir, ‘{name}-{ver}.dist-info’.format(<a href="#id1"><span class="problematic" id="id2">**</span></a>egg_info))
bw.egg2dist(os.path.join(dir, ‘EGG-INFO’), dist_info_dir)
bw.write_wheelfile(dist_info_dir, generator=’egg2wheel’)
wheel_name = ‘{name}-{ver}-{pyver}-{}-{}.whl’.format(abi, arch, <a href="#id3"><span class="problematic" id="id4">**</span></a>egg_info)
with WheelFile(os.path.join(dest_dir, wheel_name), ‘w’) as wf:</p>
<blockquote>
<div><p>wf.write_files(dir)</p>
</div></blockquote>
<p>shutil.rmtree(dir)</p>
</dd>
<dt>def parse_wininst_info(wininfo_name, egginfo_name):</dt><dd><p>“””Extract metadata from filenames.</p>
<p>Extracts the 4 metadataitems needed (name, version, pyversion, arch) from
the installer filename and the name of the egg-info directory embedded in
the zipfile (if any).</p>
<p>The egginfo filename has the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="o">-</span><span class="n">ver</span><span class="p">(</span><span class="o">-</span><span class="n">pyver</span><span class="p">)(</span><span class="o">-</span><span class="n">arch</span><span class="p">)</span><span class="o">.</span><span class="n">egg</span><span class="o">-</span><span class="n">info</span>
</pre></div>
</div>
<p>The installer filename has the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="o">-</span><span class="n">ver</span><span class="o">.</span><span class="n">arch</span><span class="p">(</span><span class="o">-</span><span class="n">pyver</span><span class="p">)</span><span class="o">.</span><span class="n">exe</span>
</pre></div>
</div>
<p>Some things to note:</p>
<ol class="arabic simple">
<li><p>The installer filename is not definitive. An installer can be renamed
and work perfectly well as an installer. So more reliable data should
be used whenever possible.</p></li>
<li><p>The egg-info data should be preferred for the name and version, because
these come straight from the distutils metadata, and are mandatory.</p></li>
<li><p>The pyver from the egg-info data should be ignored, as it is
constructed from the version of Python used to build the installer,
which is irrelevant - the installer filename is correct here (even to
the point that when it’s not there, any version is implied).</p></li>
<li><p>The architecture must be taken from the installer filename, as it is
not included in the egg-info data.</p></li>
<li><p>Architecture-neutral installers still have an architecture because the
installer format itself (being executable) is architecture-specific. We
should therefore ignore the architecture if the content is pure-python.</p></li>
</ol>
<p>“””</p>
<p>egginfo = None
if egginfo_name:</p>
<blockquote>
<div><p>egginfo = egg_info_re.search(egginfo_name)
if not egginfo:</p>
<blockquote>
<div><p>raise ValueError(“Egg info filename %s is not valid” % (egginfo_name,))</p>
</div></blockquote>
</div></blockquote>
<p># Parse the wininst filename
# 1. Distribution name (up to the first ‘-‘)
w_name, sep, rest = wininfo_name.partition(‘-‘)
if not sep:</p>
<blockquote>
<div><p>raise ValueError(“Installer filename %s is not valid” % (wininfo_name,))</p>
</div></blockquote>
<p># Strip ‘.exe’
rest = rest[:-4]
# 2. Python version (from the last ‘-’, must start with ‘py’)
rest2, sep, w_pyver = rest.rpartition(‘-‘)
if sep and w_pyver.startswith(‘py’):</p>
<blockquote>
<div><p>rest = rest2
w_pyver = w_pyver.replace(‘.’, ‘’)</p>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p># Not version specific - use py2.py3. While it is possible that
# pure-Python code is not compatible with both Python 2 and 3, there
# is no way of knowing from the wininst format, so we assume the best
# here (the user can always manually rename the wheel to be more
# restrictive if needed).
w_pyver = ‘py2.py3’</p>
</dd>
</dl>
<p># 3. Version and architecture
w_ver, sep, w_arch = rest.rpartition(‘.’)
if not sep:</p>
<blockquote>
<div><p>raise ValueError(“Installer filename %s is not valid” % (wininfo_name,))</p>
</div></blockquote>
<dl class="simple">
<dt>if egginfo:</dt><dd><p>w_name = egginfo.group(‘name’)
w_ver = egginfo.group(‘ver’)</p>
</dd>
</dl>
<p>return {‘name’: w_name, ‘ver’: w_ver, ‘arch’: w_arch, ‘pyver’: w_pyver}</p>
</dd>
<dt>def wininst2wheel(path, dest_dir):</dt><dd><dl>
<dt>with zipfile.ZipFile(path) as bdw:</dt><dd><p># Search for egg-info in the archive
egginfo_name = None
for filename in bdw.namelist():</p>
<blockquote>
<div><dl class="simple">
<dt>if ‘.egg-info’ in filename:</dt><dd><p>egginfo_name = filename
break</p>
</dd>
</dl>
</div></blockquote>
<p>info = parse_wininst_info(os.path.basename(path), egginfo_name)</p>
<p>root_is_purelib = True
for zipinfo in bdw.infolist():</p>
<blockquote>
<div><dl class="simple">
<dt>if zipinfo.filename.startswith(‘PLATLIB’):</dt><dd><p>root_is_purelib = False
break</p>
</dd>
</dl>
</div></blockquote>
<dl class="simple">
<dt>if root_is_purelib:</dt><dd><p>paths = {‘purelib’: ‘’}</p>
</dd>
<dt>else:</dt><dd><p>paths = {‘platlib’: ‘’}</p>
</dd>
</dl>
<p>dist_info = “%(name)s-%(ver)s” % info
datadir = “%s.data/” % dist_info</p>
<p># rewrite paths to trick ZipFile into extracting an egg
# XXX grab wininst .ini - between .exe, padding, and first zip file.
members = []
egginfo_name = ‘’
for zipinfo in bdw.infolist():</p>
<blockquote>
<div><p>key, basename = zipinfo.filename.split(‘/’, 1)
key = key.lower()
basepath = paths.get(key, None)
if basepath is None:</p>
<blockquote>
<div><p>basepath = datadir + key.lower() + ‘/’</p>
</div></blockquote>
<p>oldname = zipinfo.filename
newname = basepath + basename
zipinfo.filename = newname
del bdw.NameToInfo[oldname]
bdw.NameToInfo[newname] = zipinfo
# Collect member names, but omit ‘’ (from an entry like “PLATLIB/”
if newname:</p>
<blockquote>
<div><p>members.append(newname)</p>
</div></blockquote>
<p># Remember egg-info name for the egg2dist call below
if not egginfo_name:</p>
<blockquote>
<div><dl class="simple">
<dt>if newname.endswith(‘.egg-info’):</dt><dd><p>egginfo_name = newname</p>
</dd>
<dt>elif ‘.egg-info/’ in newname:</dt><dd><p>egginfo_name, sep, _ = newname.rpartition(‘/’)</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>dir = tempfile.mkdtemp(suffix=”_b2w”)
bdw.extractall(dir, members)</p>
</dd>
</dl>
<p># egg2wheel
abi = ‘none’
pyver = info[‘pyver’]
arch = (info[‘arch’] or ‘any’).replace(‘.’, ‘_’).replace(‘-’, ‘_’)
# Wininst installers always have arch even if they are not
# architecture-specific (because the format itself is).
# So, assume the content is architecture-neutral if root is purelib.
if root_is_purelib:</p>
<blockquote>
<div><p>arch = ‘any’</p>
</div></blockquote>
<p># If the installer is architecture-specific, it’s almost certainly also
# CPython-specific.
if arch != ‘any’:</p>
<blockquote>
<div><p>pyver = pyver.replace(‘py’, ‘cp’)</p>
</div></blockquote>
<p>wheel_name = ‘-‘.join((dist_info, pyver, abi, arch))
if root_is_purelib:</p>
<blockquote>
<div><p>bw = bdist_wheel(dist.Distribution())</p>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p>bw = _bdist_wheel_tag(dist.Distribution())</p>
</dd>
</dl>
<p>bw.root_is_pure = root_is_purelib
bw.python_tag = pyver
bw.plat_name_supplied = True
bw.plat_name = info[‘arch’] or ‘any’</p>
<dl class="simple">
<dt>if not root_is_purelib:</dt><dd><p>bw.full_tag_supplied = True
bw.full_tag = (pyver, abi, arch)</p>
</dd>
</dl>
<p>dist_info_dir = os.path.join(dir, ‘%s.dist-info’ % dist_info)
bw.egg2dist(os.path.join(dir, egginfo_name), dist_info_dir)
bw.write_wheelfile(dist_info_dir, generator=’wininst2wheel’)</p>
<p>wheel_path = os.path.join(dest_dir, wheel_name)
with WheelFile(wheel_path, ‘w’) as wf:</p>
<blockquote>
<div><p>wf.write_files(dir)</p>
</div></blockquote>
<p>shutil.rmtree(dir)</p>
</dd>
<dt>def convert(files, dest_dir, verbose):</dt><dd><p># Only support wheel convert if pkg_resources is present
require_pkgresources(‘wheel convert’)</p>
<dl>
<dt>for pat in files:</dt><dd><dl>
<dt>for installer in iglob(pat):</dt><dd><dl class="simple">
<dt>if os.path.splitext(installer)[1] == ‘.egg’:</dt><dd><p>conv = egg2wheel</p>
</dd>
<dt>else:</dt><dd><p>conv = wininst2wheel</p>
</dd>
<dt>if verbose:</dt><dd><p>print(“{}… “.format(installer))
sys.stdout.flush()</p>
</dd>
</dl>
<p>conv(installer, dest_dir)
if verbose:</p>
<blockquote>
<div><p>print(“OK”)</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, hrishabh kamal.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>